# 📖 note SNS投稿支援システム 使用マニュアル

## 目次

1. [システム概要](#システム概要)
2. [初期セットアップ](#初期セットアップ)
3. [使用方法](#使用方法)
4. [画面説明](#画面説明)
5. [トラブルシューティング](#トラブルシューティング)

---

## システム概要

### できること

- ✅ noteで公開した記事を一覧で取得
- ✅ X（Twitter）用の投稿文を自動生成（280文字以内）
- ✅ Instagram用のキャプションを自動生成
- ✅ 投稿前に内容を確認・編集
- ✅ ワンクリックでX/Instagramへ投稿

### システム構成

```
┌─────────────┐
│   note      │ ← 記事を公開
└──────┬──────┘
       │ RSS取得
       ↓
┌─────────────────────────┐
│  本システム（ブラウザ）  │
│  - 記事一覧表示         │
│  - 投稿文自動生成       │
│  - 内容確認・編集       │
└──────┬──────────────┬───┘
       │              │
       ↓              ↓
   ┌───────┐      ┌──────────┐
   │   X   │      │Instagram │
   └───────┘      └──────────┘
```

---

## 初期セットアップ

### ステップ1: Node.jsのインストール

#### Homebrewを使用する場合（推奨）

```bash
# Homebrewがインストールされていない場合
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Node.jsをインストール
brew install node

# インストール確認
node --version  # v16以上であることを確認
npm --version
```

#### 公式サイトからインストールする場合

1. https://nodejs.org/ にアクセス
2. LTS版（推奨版）をダウンロード
3. インストーラーを実行

### ステップ2: プロジェクトのセットアップ

```bash
# プロジェクトディレクトリに移動
cd /Users/tk/Downloads/SNStransmission

# 依存関係をインストール
npm install
```

成功すると、`node_modules`フォルダが作成されます。

### ステップ3: 環境変数ファイルの作成

```bash
# .env.exampleをコピーして.envを作成
cp .env.example .env
```

### ステップ4: API認証情報の設定

`.env`ファイルをテキストエディタで開き、以下の情報を設定します。

#### 4-1. note RSS URLの設定

```env
NOTE_RSS_URL=https://note.com/あなたのユーザー名/rss
```

**取得方法:**
1. noteのプロフィールページを開く
2. URLをコピー（例: `https://note.com/username`）
3. 末尾に `/rss` を追加

**確認方法:**
- ブラウザでRSS URLにアクセスし、XML形式のデータが表示されればOK

#### 4-2. X (Twitter) API認証情報の設定

```env
X_API_KEY=あなたのAPIキー
X_API_SECRET=あなたのAPIシークレット
X_ACCESS_TOKEN=あなたのアクセストークン
X_ACCESS_SECRET=あなたのアクセスシークレット
```

**取得方法:**

1. **Twitter Developer Portalにアクセス**
   - https://developer.twitter.com/en/portal/dashboard

2. **プロジェクトを作成**
   - 「+ Create Project」をクリック
   - プロジェクト名を入力（例: "note投稿システム"）
   - 用途を選択（個人利用の場合は "Making a bot"）

3. **アプリを作成**
   - アプリ名を入力
   - API KeyとAPI Secretが表示される → **必ず保存**

4. **権限を設定**
   - アプリの設定画面で「Settings」タブを開く
   - 「User authentication settings」を編集
   - App permissions: **Read and Write** を選択
   - Type of App: **Web App** を選択
   - Callback URL: `http://localhost:3000` を入力
   - Website URL: あなたのnoteプロフィールURLを入力

5. **Access TokenとSecretを生成**
   - 「Keys and tokens」タブを開く
   - 「Access Token and Secret」セクションで「Generate」をクリック
   - Access TokenとAccess Secretが表示される → **必ず保存**

#### 4-3. Instagram Graph API認証情報の設定

```env
INSTAGRAM_ACCESS_TOKEN=あなたのアクセストークン
INSTAGRAM_BUSINESS_ACCOUNT_ID=あなたのビジネスアカウントID
```

> **⚠️ 重要:** Instagram Graph APIは**Instagramビジネスアカウント**が必須です。個人アカウントでは利用できません。

**取得方法:**

1. **Instagramをビジネスアカウントに変換**
   - Instagramアプリを開く
   - プロフィール → メニュー → 設定
   - アカウント → プロアカウントに切り替える
   - ビジネスを選択

2. **Facebookページを作成**
   - https://www.facebook.com/pages/create にアクセス
   - ページ名を入力して作成

3. **InstagramとFacebookページを連携**
   - Facebookページの設定を開く
   - Instagram → アカウントをリンク
   - Instagramにログインして連携

4. **Meta for Developersでアプリを作成**
   - https://developers.facebook.com/ にアクセス
   - 「マイアプリ」→「アプリを作成」
   - タイプ: **ビジネス** を選択
   - アプリ名を入力

5. **Instagram Graph APIを追加**
   - アプリダッシュボードで「製品を追加」
   - 「Instagram Graph API」を選択

6. **アクセストークンを取得**
   - ツール → Graph APIエクスプローラー
   - アプリを選択
   - ユーザートークンを生成
   - 権限: `instagram_basic`, `instagram_content_publish` を選択
   - トークンを生成 → **必ず保存**

7. **ビジネスアカウントIDを取得**
   - Graph APIエクスプローラーで以下を実行:
   ```
   GET /me/accounts
   ```
   - Facebookページのaccess_tokenをコピー
   - 次に以下を実行:
   ```
   GET /{page-id}?fields=instagram_business_account
   ```
   - `instagram_business_account.id` の値がビジネスアカウントID

**簡易的な取得方法（テスト用）:**
- Graph APIエクスプローラーで以下を実行:
  ```
  GET /me?fields=id,name
  ```

### ステップ5: サーバーの起動

```bash
npm start
```

以下のメッセージが表示されれば成功です:

```
🚀 サーバーが起動しました: http://localhost:3000
📝 note SNS投稿支援システム
```

---

## 使用方法

### 基本的な流れ

```
1. ブラウザでシステムを開く
   ↓
2. note記事を取得
   ↓
3. 投稿したい記事を選択
   ↓
4. 投稿文を確認・編集
   ↓
5. X/Instagramに投稿
```

### 詳細手順

#### 1. システムを開く

ブラウザで以下のURLにアクセス:
```
http://localhost:3000
```

#### 2. API接続状態を確認

画面上部のステータスバッジを確認:
- 🟢 緑色の点: 接続成功
- ⚫ グレーの点: 接続失敗（API認証情報を確認）

#### 3. note記事を取得

1. 「🔄 note記事を取得」ボタンをクリック
2. 読み込み中のスピナーが表示される
3. 記事カードが一覧表示される

**表示される情報:**
- サムネイル画像
- 記事タイトル
- 記事の抜粋
- 公開日

#### 4. 投稿したい記事を選択

1. 記事カードをクリック
2. 投稿確認モーダルが開く
3. 投稿文が自動生成される

**自動生成される内容:**

**X用投稿文:**
```
記事タイトル（要約）

https://note.com/username/n/xxxxx

#note #ブログ更新
```

**Instagram用キャプション:**
```
📝 記事タイトル

記事の抜粋...

🔗 詳しくはプロフィールのリンクから
https://note.com/username/n/xxxxx

#note #ブログ #新着記事
```

#### 5. 投稿文を編集（任意）

- テキストエリアをクリックして自由に編集可能
- X投稿文は**280文字以内**（文字数カウンター表示）
- 250文字を超えると黄色、280文字を超えると赤色で警告

#### 6. 投稿を実行

**Xに投稿する場合:**
1. 「𝕏 Xに投稿」ボタンをクリック
2. 「投稿中...」と表示される
3. 成功すると「✅ Xへの投稿に成功しました！」と表示
4. モーダルが自動的に閉じる

**Instagramに投稿する場合:**
1. 「📷 Instagramに投稿」ボタンをクリック
2. 「投稿中...」と表示される
3. 成功すると「✅ Instagramへの投稿に成功しました！」と表示
4. モーダルが自動的に閉じる

**投稿をキャンセルする場合:**
- 「キャンセル」ボタンをクリック
- または「×」ボタンをクリック
- またはモーダル外の暗い部分をクリック

---

## 画面説明

### メイン画面

```
┌─────────────────────────────────────┐
│  📝 note SNS投稿支援システム         │
│  note記事をInstagramとXへ簡単に投稿  │
├─────────────────────────────────────┤
│  [🟢 X API] [🟢 Instagram API]      │ ← API接続状態
├─────────────────────────────────────┤
│  [🔄 note記事を取得]                │ ← 記事取得ボタン
├─────────────────────────────────────┤
│  ┌──────┐ ┌──────┐ ┌──────┐        │
│  │画像  │ │画像  │ │画像  │        │
│  │タイトル│ │タイトル│ │タイトル│        │
│  │抜粋  │ │抜粋  │ │抜粋  │        │
│  │日付  │ │日付  │ │日付  │        │
│  └──────┘ └──────┘ └──────┘        │ ← 記事カード
└─────────────────────────────────────┘
```

### 投稿確認モーダル

```
┌─────────────────────────────────────┐
│  📤 投稿内容の確認              [×] │
├─────────────────────────────────────┤
│  記事タイトル                        │
│  記事を開く →                        │
├─────────────────────────────────────┤
│  𝕏 X (Twitter) 投稿文               │
│  ┌─────────────────────────────┐   │
│  │ 投稿文テキストエリア          │   │
│  │ （編集可能）                 │   │
│  └─────────────────────────────┘   │
│  0 / 280                            │ ← 文字数カウンター
├─────────────────────────────────────┤
│  📷 Instagram キャプション           │
│  ┌─────────────────────────────┐   │
│  │ キャプションテキストエリア    │   │
│  │ （編集可能）                 │   │
│  └─────────────────────────────┘   │
│  画像: https://...                  │
├─────────────────────────────────────┤
│  [キャンセル] [𝕏 Xに投稿] [📷 Instagramに投稿] │
└─────────────────────────────────────┘
```

---

## トラブルシューティング

### Q1. 「note記事を取得」を押しても記事が表示されない

**原因:**
- `.env`ファイルの`NOTE_RSS_URL`が正しくない
- noteのRSSフィードが公開されていない

**解決方法:**
1. `.env`ファイルを開く
2. `NOTE_RSS_URL`を確認
3. ブラウザで直接RSS URLにアクセスしてXMLが表示されるか確認
4. noteの設定で記事が公開されているか確認

### Q2. X投稿が失敗する

**エラー: "X API認証情報が設定されていません"**
- `.env`ファイルの`X_API_KEY`, `X_API_SECRET`, `X_ACCESS_TOKEN`, `X_ACCESS_SECRET`を確認

**エラー: "投稿に失敗しました"**
- Twitter Developer Portalでアプリの権限が「Read and Write」になっているか確認
- Access TokenとSecretを再生成してみる
- 投稿文が280文字以内か確認

### Q3. Instagram投稿が失敗する

**エラー: "Instagram API認証情報が設定されていません"**
- `.env`ファイルの`INSTAGRAM_ACCESS_TOKEN`, `INSTAGRAM_BUSINESS_ACCOUNT_ID`を確認

**エラー: "投稿に失敗しました"**
- Instagramビジネスアカウントを使用しているか確認（個人アカウントは不可）
- FacebookページとInstagramが正しく連携されているか確認
- アクセストークンの権限に`instagram_content_publish`が含まれているか確認
- サムネイル画像のURLが公開アクセス可能か確認

### Q4. サーバーが起動しない

**エラー: "npm: command not found"**
- Node.jsがインストールされていない
- `brew install node`でインストール

**エラー: "Cannot find module 'express'"**
- 依存関係がインストールされていない
- `npm install`を実行

**エラー: "Port 3000 is already in use"**
- ポート3000が既に使用されている
- `.env`ファイルで`PORT=3001`など別のポートを指定

### Q5. 画面が真っ白/デザインが崩れている

**原因:**
- CSSファイルが読み込まれていない
- JavaScriptエラーが発生している

**解決方法:**
1. ブラウザの開発者ツールを開く（F12キー）
2. Consoleタブでエラーを確認
3. Networkタブで`style.css`と`app.js`が正しく読み込まれているか確認
4. ブラウザのキャッシュをクリアして再読み込み（Cmd+Shift+R）

---

## よくある質問

### Q. 複数のnoteアカウントを管理できますか？

現在のバージョンでは1つのnoteアカウントのみ対応しています。
複数アカウントを管理したい場合は、`.env`ファイルを切り替えるか、別のプロジェクトフォルダを作成してください。

### Q. 予約投稿はできますか？

現在のバージョンでは即時投稿のみ対応しています。
予約投稿機能は将来のアップデートで追加予定です。

### Q. 投稿履歴は保存されますか？

現在のバージョンでは投稿履歴の保存機能はありません。
投稿後はX/Instagramの各プラットフォームで確認してください。

### Q. 画像を編集・加工できますか？

現在のバージョンでは画像の編集・加工機能はありません。
noteのサムネイル画像をそのまま使用します。

### Q. スマートフォンから使用できますか？

レスポンシブデザインに対応しているため、スマートフォンのブラウザからも使用可能です。
ただし、サーバーは起動しておく必要があります。

---

## サポート

問題が解決しない場合は、以下の情報を確認してください:

1. **Node.jsのバージョン**: `node --version`
2. **エラーメッセージ**: ブラウザの開発者ツール（F12）のConsoleタブ
3. **サーバーログ**: ターミナルに表示されるエラーメッセージ
4. **環境変数**: `.env`ファイルの設定（認証情報は除く）

---

**システムの使用方法について不明な点があれば、お気軽にお問い合わせください！** 📧
